---
title: "Introduction to Hansard"
author: "Evan Odell"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

`hansard` is an R package to pull data from the UK parliament through the <http://www.data.parliament.uk/> API. It emphasises simplicity and ease of use, so that users unfamiliar with APIs can easily retrieve large volumes of high quality data. Each function accepts a single argument at a time, and functions that require additional information to retrieve the data you requested will ask for it after you execute the function. Functions retrieve data in json format and convert it to a data frame. The `hansard_generic` function supports the building of API requests for XML, csv or HTML formats if required. Note that the API is rate limited to returning 5500 rows per request in some circumstances.

##Installing hansard

###From CRAN

```
install.packages("hansard")`
```

###From GitHub (Development Version)

```
install.packages("devtools")
devtools::install_github("EvanOdell/hansard")
```

###Load hansard

```
library(hansard)
```

##Using hansard

`hansard` contains functions for calling data for the UK Parliament API. Most of the functions are designed to call data from a specific <http://www.data.parliament.uk/> API, but several functions have special or experimental features:

* `research_briefings_lists` An experimental feature that creates lists of possible parameters, and allows the user to call to the API based on the content of the list. Currently only available with the `research_briefings_lists` function.

* `hansard_generic` A basic wrapper function for any of the available APIs. Users must specify the exact path they want the function to call from, and must also specify JSON formatting.

* `members_search` A search function for members of the House of Commons and House of Lords.

### The `members_search` function

Looking up information on an individual MP or Lord through the Parliamentary API requires knowing their parliamentary ID number. This can be hard to find on the web, but luckily you can look it up through the API. We want information on the voting record of the Labour MP for Hackney North and Stoke Newington Diane Abbott, but we don't know her ID number, so we search for her:

```{r eval=FALSE}
library(hansard)
members_search("abbot")
#> Connecting to API
#> Retrieving page 1 of 1
#>     mnis_id                         home_page additional_name_value                         constituency_about
#> 1     172     http://www.dianeabbott.org.uk                 Julie http://data.parliament.uk/resources/146966
#> 2    1651                              <NA>             Granville                                       <NA>
#> 3    4249 http://www.annemariemorris.co.uk/                  <NA> http://data.parliament.uk/resources/147092
#> 4    3827       http://www.judiciary.gov.uk                Edmond                                       <NA>
#>            constituency_label_value family_name_value                full_name_value gender_value
#> 1 Hackney North and Stoke Newington            Abbott                Ms Diane Abbott       Female
#> 2                              <NA>           Hodgson Lord Hodgson of Astley Abbotts         Male
#> 3                      Newton Abbot            Morris              Anne Marie Morris       Female
#> 4                              <NA>         Neuberger   Lord Neuberger of Abbotsbury         Male
#>   given_name_value                                              label_value  party_value
#> 1            Diane                Biography information for Ms Diane Abbott       Labour
#> 2            Robin Biography information for Lord Hodgson of Astley Abbotts         <NA>
#> 3       Anne Marie              Biography information for Anne Marie Morris Conservative
#> 4            David   Biography information for Lord Neuberger of Abbotsbury         <NA>
#>                       twitter_value
#> 1 https://twitter.com/HackneyAbbott
#> 2                              <NA>
#> 3    https://twitter.com/AMMorrisMP
#> 4                              <NA>
```


The same function, without the use of the tidy parameter, illustrating the differences in the variable names and the presentation of information in the first column:


```{r eval=FALSE}
library(hansard)
members_search("abbot", tidy = FALSE)
#> Connecting to API
#> Retrieving page 1 of 1
#>                                   _about                          homePage additionalName._value
#> 1  http://data.parliament.uk/members/172     http://www.dianeabbott.org.uk                 Julie
#> 2 http://data.parliament.uk/members/1651                              <NA>             Granville
#> 3 http://data.parliament.uk/members/4249 http://www.annemariemorris.co.uk/                  <NA>
#> 4 http://data.parliament.uk/members/3827       http://www.judiciary.gov.uk                Edmond
#>                          constituency._about         constituency.label._value familyName._value                fullName._value
#> 1 http://data.parliament.uk/resources/146966 Hackney North and Stoke Newington            Abbott                Ms Diane Abbott
#> 2                                       <NA>                              <NA>           Hodgson Lord Hodgson of Astley Abbotts
#> 3 http://data.parliament.uk/resources/147092                      Newton Abbot            Morris              Anne Marie Morris
#> 4                                       <NA>                              <NA>         Neuberger   Lord Neuberger of Abbotsbury
#>   gender._value givenName._value                                             label._value party._value
#> 1        Female            Diane                Biography information for Ms Diane Abbott       Labour
#> 2          Male            Robin Biography information for Lord Hodgson of Astley Abbotts         <NA>
#> 3        Female       Anne Marie              Biography information for Anne Marie Morris Conservative
#> 4          Male            David   Biography information for Lord Neuberger of Abbotsbury         <NA>
#>                      twitter._value
#> 1 https://twitter.com/HackneyAbbott
#> 2                              <NA>
#> 3    https://twitter.com/AMMorrisMP
#> 4                              <NA>
```


The search function is not case sensitive, and searchs in the names and constituencies of all MPs and Lords. So even though we spelled her surname incorrectly, we can still find her. This API provides limited biographical details, to retrieve more detailed biographical information, use the related [`mnis`](https://cran.r-project.org/package=mnis) package to retrives data from the Members' Names Information Service.


### The `commons_divisions` and `mp_vote_record` functions

The `commons_divisions` function returns divisions in the House of Commons, including the result of votes and information on what we being voted on. `mp_vote_record` returns a data frame the voting record of a given MP on each division they voted in. The example below returns all Commons Divisions where Diane Abbott voted aye.

```{r eval = FALSE}
x <- mp_vote_record(172, "aye")
#> Retrieving page 1 of 4
#> Retrieving page 2 of 4
#> Retrieving page 3 of 4
#> Retrieving page 4 of 4
#> head(x)
#>                                       about                                                             title
#> 1 http://data.parliament.uk/resources/713962              Bus Services Bill [Lords]: Report Stage New Clause 1
#> 2 http://data.parliament.uk/resources/713963              Bus Services Bill [Lords]: Report Stage New Clause 2
#> 3 http://data.parliament.uk/resources/714005               Bus Services Bill [Lords]: Report Stage Amendment 1
#> 4 http://data.parliament.uk/resources/710264                      Reproductive Health (Access to Terminations)
#> 5 http://data.parliament.uk/resources/708770 Children and Social Work Bill (Lords): Report Stage New Clause 14
#> 6 http://data.parliament.uk/resources/708773  Children and Social Work Bill (Lords): Report Stage Amendment 12
#>                 uin date_value date_datatype
#> 1 CD:2017-03-27:255 2017-03-27      dateTime
#> 2 CD:2017-03-27:256 2017-03-27      dateTime
#> 3 CD:2017-03-27:257 2017-03-27      dateTime
#> 4 CD:2017-03-13:243 2017-03-13      dateTime
#> 5 CD:2017-03-07:240 2017-03-07      dateTime
#> 6 CD:2017-03-07:241 2017-03-07      dateTime

```

The results of votes in the House of Lords can be retrieved with the `lords_divisions` function. The voting record of individual Lords can  be retrieved using the `lords_vote_record` functions. 


### The `research_briefings` function

The `research_briefings` function includes the experimental feature of requesting data using lists created using the `research_briefings_lists` functions:

```{r eval = FALSE}
#> research_topics_list <- research_topics_list()
#> 
#> research_subtopics_list <- research_subtopics_list()
#> 
#> research_types_list <- research_types_list()
#>
#> research_topics_list[[7]]
#> [1] "Defence"
#>
#> research_subtopics_list[[7]][10]
#> [1] "Falkland Islands"
#>
#> research_types_list[[1]]
#> [1] "Lords Library notes"

```

In this case I have given them the same name as their function, but you can assign any name you wish to them.

Having created the lists, they can be used to specify which topics and subtopics to call, although strings can also be used.

```{r eval = FALSE}
#> x <- research_briefings(topic = research_topics_list[[7]])
#>
#> x <- research_briefings(topic = research_topics_list[[7]], subtopic=research_subtopics_list[[7]][10])
#>
#> x <- research_briefings(topic = "Defence")

```

If a specific subtopic is called, but the topic is not specified, the function will still return all data within that specific subtopic. Note that this is slower than specifying the topic and subtopic.

```{r eval = FALSE}
#> x <- research_briefings(subtopic = research_subtopics_list[[7]][10])
#> 
#> x <- research_briefings(subtopic = "Falkland Islands")
#>
#> system.time(without_topic <- research_briefings(subtopic = research_subtopics_list[[7]][10]))
#> Retrieving page 1 of 1
#>   user  system elapsed 
#>   1.12    2.59    4.71 
#>
#> system.time(with_topic <- research_briefings(topic = research_topics_list[[7]], subtopic=research_subtopics_list[[7]][10]))
#> Retrieving page 1 of 1
#>    user  system elapsed 
#>    0.47    1.31    1.89 
#>
#> all.equal(with_topic, without_topic)
#> [1] TRUE
```


If a specified subtopic is not a subtopic of the specified topic, the function will not return any data.

### The `hansard_generic` function

The `hansard_generic` function allows you to put in your own paths to the API. Information on all the paths available in the API can be found on the [DDP Explorer website](http://explore.data.parliament.uk/).

```{r, eval=FALSE}
x <- hansard_generic("commonsansweredquestions.json")
```

Note that the API defaults to returning 10 items per page, but allows up to 500 items per page.
